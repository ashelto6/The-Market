{% extends 'base.html' %}
{% block uppertitle %} PORTFOLIO {% endblock %}
{% block title %} Portfolio {% endblock %}
{% block date %} {{date}} {% endblock %}
{% block content %} {% with messages = get_flashed_messages() %} {% if messages %}
<div class="container notification is-success" id="marg">{{ messages[0] }}</div>
{% endif %} {% endwith %}

<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
<br><br>
<div class="container">
  <div class="col mb-4">
    <!-- this block is shown on regular to large screens -->
    <div id="page">
      <div class="maincontent">
        <div class="container">
          <div class="text-center">
            <span id="update_Portfoliodata">
              <div class="row row-cols-1 row-cols-md-2">
                {% for ticker in
              data[0].securitiesAccount.positions|sort(attribute='marketValue',
              reverse=True) %}
                <!-- sorting the data by greatest market value to least -->
                <div class="col mb-4">
                  {% if
                "%.2f"|format(ticker.marketValue/ticker.longQuantity)|float <
                "%.2f"|format(ticker.averagePrice)|float %}
                  <div class="card card-red">
                    <div class="card-body">
                      <h5 class="card-title">{{ticker.instrument.symbol}}</h5>
                      <p>
                        <b>Current Price</b>: {{
                      "$%.2f"|format(ticker.marketValue/ticker.longQuantity) }}
                      </p>
                      <p></p>
                      <div class="card card-body">
                        <div class="container">
                          <p>
                            <small><b>Avg. PPS</b>:
                              {{"$%.2f"|format(ticker.averagePrice)}}</small>
                          </p>
                          <p>
                            <small><b>Quantity</b>: {{ticker.longQuantity}}</small>
                          </p>
                          <p>
                            <small><b>Net Worth</b>:
                              {{"$%.2f"|format(ticker.marketValue)}}</small>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% elif
                "%.2f"|format(ticker.marketValue/ticker.longQuantity)|float >
                "%.2f"|format(ticker.averagePrice)|float %}
                  <div class="card card-green">
                    <div class="card-body">
                      <h5 class="card-title">{{ticker.instrument.symbol}}</h5>
                      <p>
                        <b>Current Price</b>: {{
                      "$%.2f"|format(ticker.marketValue/ticker.longQuantity) }}
                      </p>
                      <p></p>
                      <div class="card card-body">
                        <div class="container">
                          <p>
                            <small><b>Avg. PPS</b>:
                              {{"$%.2f"|format(ticker.averagePrice)}}</small>
                          </p>
                          <p>
                            <small><b>Quantity</b>: {{ticker.longQuantity}}</small>
                          </p>
                          <p>
                            <small><b>Net Worth</b>:
                              {{"$%.2f"|format(ticker.marketValue)}}</small>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% else %}
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title">{{ticker.instrument.symbol}}</h5>
                      <p>
                        <b>Current Price</b>: {{
                      "$%.2f"|format(ticker.marketValue/ticker.longQuantity) }}
                      </p>
                      <p></p>
                      <div class="card card-body">
                        <div class="container">
                          <p>
                            <small><b>Avg PPS</b>:
                              {{"$%.2f"|format(ticker.averagePrice)}}</small>
                          </p>
                          <p>
                            <small><b>Quantity</b>: {{ticker.longQuantity}}</small>
                          </p>
                          <p>
                            <small><b>Net Worth</b>:
                              {{"$%.2f"|format(ticker.marketValue)}}</small>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}
                </div>
                {% endfor %}
              </div>
            </span>
          </div>
        </div>
      </div>

      <div class="menuleftcontent">
        <ul id="menu">
          <li><a href="#"><button class="button is-info is-rounded">Menu</button></a></li>
          <li><a href="#"><button class="button is-success is-rounded">will</button></a></li>
          <li><a href="#"><button class="button is-warning is-rounded">go</button></a></li>
          <li><a href="#"><button class="button is-danger is-rounded">here</button></a></li>
        </ul>
      </div>
      <div id="clearingdiv"></div>
    </div>

    <!-- this block is shown on small screens -->

    <div class="maincontent-sm">
      <span id="update_Portfoliodata_sm">
        {% for ticker in
      data[0].securitiesAccount.positions|sort(attribute='marketValue',
      reverse=True) %}
        <div class="container">
          <div class="text-center">
            <div class="row row-cols-1 row-cols-md-2">
              <div class="col mb-4">
                {% if "%.2f"|format(ticker.marketValue/ticker.longQuantity)|float
              < "%.2f"|format(ticker.averagePrice)|float %}

                <div class="card card-red">
                  <div class="card-body">
                    <h5 class="card-title">{{ticker.instrument.symbol}}</h5>
                    <p>
                      <b>Current Price</b>: {{
                    "$%.2f"|format(ticker.marketValue/ticker.longQuantity) }}
                    </p>


                    <div class="card card-body">
                      <p>
                        <small><b>Avg. PPS</b>:
                          {{"$%.2f"|format(ticker.averagePrice)}}</small>
                      </p>
                      <p>
                        <small><b>Quantity</b>: {{ticker.longQuantity}}</small>
                      </p>
                      <p>
                        <small><b>Net Worth</b>:
                          {{"$%.2f"|format(ticker.marketValue)}}</small>
                      </p>
                    </div>
                  </div>
                </div>

                {% elif
              "%.2f"|format(ticker.marketValue/ticker.longQuantity)|float >
              "%.2f"|format(ticker.averagePrice)|float %}

                <div class="card card-green">
                  <div class="card-body">
                    <h5 class="card-title">{{ticker.instrument.symbol}}</h5>
                    <p>
                      <b>Current Price</b>: {{
                    "$%.2f"|format(ticker.marketValue/ticker.longQuantity) }}
                    </p>

                    <div class="card card-body">
                      <p>
                        <small><b>Avg. PPS</b>:
                          {{"$%.2f"|format(ticker.averagePrice)}}</small>
                      </p>
                      <p>
                        <small><b>Quantity</b>: {{ticker.longQuantity}}</small>
                      </p>
                      <p>
                        <small><b>Net Worth</b>:
                          {{"$%.2f"|format(ticker.marketValue)}}</small>
                      </p>
                    </div>
                  </div>
                </div>

                {% else %}

                <div class="card">
                  <div class="card-body">
                    <h5 class="card-title">{{ticker.instrument.symbol}}</h5>
                    <p>
                      <b>Current Price</b>: {{
                    "$%.2f"|format(ticker.marketValue/ticker.longQuantity) }}
                    </p>

                    <div class="card card-body">
                      <p>
                        <small><b>Avg. PPS</b>:
                          {{"$%.2f"|format(ticker.averagePrice)}}</small>
                      </p>
                      <p>
                        <small><b>Quantity</b>: {{ticker.longQuantity}}</small>
                      </p>
                      <p>
                        <small><b>Net Worth</b>:
                          {{"$%.2f"|format(ticker.marketValue)}}</small>
                      </p>
                    </div>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </span>
    </div>
  </div>
</div>
<br /><br />

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script>
  /* Ajax */
  $(function () {
    window.setInterval(function () {
      loadNewPortfoliodata()
    }, 2500)

    function loadNewPortfoliodata() {
      $.ajax({
        url: "/update_Portfoliodata",
        type: "POST",
        dataType: "json",
        success: function (data) {
          $(update_Portfoliodata).replaceWith(data)
        }

      });
    }
  });

  $(function () {
    window.setInterval(function () {
      loadNewPortfoliodatasm()
    }, 2500)

    function loadNewPortfoliodatasm() {
      $.ajax({
        url: "/update_Portfoliodata_sm",
        type: "POST",
        dataType: "json",
        success: function (data) {
          $(update_Portfoliodata_sm).replaceWith(data)
        }

      });
    }
  });
  /* back to top button */
  mybutton = document.getElementById("myBtn");

  // When the user scrolls down 20px from the top of the document, show the button
  window.onscroll = function () {
    scrollFunction()
  };

  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
      mybutton.style.display = "block";
    } else {
      mybutton.style.display = "none";
    }
  }

  // When the user clicks on the button, scroll to the top of the document
  function topFunction() {
    document.body.scrollTop = 0; // For Safari
    document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
  }
</script>
{% endblock %}